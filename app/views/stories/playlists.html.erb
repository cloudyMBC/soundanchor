
<div class="container-fluid">

  <% if @story.artwork_url == nil %>
    <%= image_tag(@story.user.avatar_url.sub("large", "crop"), width: "100%") %>
    <h1 class="story-title"><%= @story.title %></h1>
    <h3 class="story-place">@SoundCloud HQ</h3>
  <% else %>
    <%= image_tag(@story.artwork_url.sub("large", "crop"), width: "100%") %>
    <h1 class="story-title"><%= @story.title %></h1>
    <h3 class="story-place">@SoundCloud HQ</h3>
  <% end %>


  <% @playlist.tracks.each do |track| %>
  <%if track.id == @story.id %>
      <iframe width="100%" height="20" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?url=https%3A//api.soundcloud.com/tracks/<%=track.id %>&amp;color=ff5500&amp;auto_play=false&amp;hide_related=false&amp;show_comments=false&amp;show_user=false&amp;show_reposts=false"></iframe>
  <% end %>
<% end %>


<br>
<br>
<p><b>More stories:</b></p>

<% @playlist.tracks.each do |track| %>
  <% if track.id != @story.id %>
    <a href="/playlists/<%=@playlist.id%>/<%=track.id%>"><%= track.title %></a>
    </br>
  <% end %>
<% end %>
<br>

<div class='comments'>
    <%= form_for :comment, :html => {:id => "commentForm"}, url: comments_path do |f| %>
      <p>
        <%= f.label :text, "How do you like this app?" %><br>
        <%= f.text_area :text, :size=>"90%", :id => "new_comment"%>
      </p>
      <p>
        <%= f.submit "Save Comment", :id =>"save_comment" %>
      </p>
    <% end %>
  </div>  

  <div id="hide_comments" class='list_comments'>
  </div>
</div>


<script type="text/javascript">
 //This one is the promise
  $("#hide_comments").hide();
  $("#commentForm").submit(function(event) {
    event.preventDefault();

    $.ajax({
      url: "/comments/",
      type: "POST",
      data: $("#commentForm").serialize(),
    }).done(function() {
      $.ajax('/comments/index').done(function(comments) {
        $("#hide_comments").html(comments).show();
        $('#new_comment').val('');
      });      
    });
  });


  //This one is callback
  // $("#comments").hide();
  // $("#commentForm").submit(function(event) {
  //   event.preventDefault();

  //   $.ajax({
  //     url: "/comments/",
  //     type: "POST",
  //     data: $("#commentForm").serialize(),
  //     success: function() {
  //       $.ajax('/comments/index').done(function(comments) {
  //         $("#comments").html(comments).show();
  //       });    
  //     }
  //   });
  // });

</script>
</div>